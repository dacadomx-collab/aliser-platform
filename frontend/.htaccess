# ============================================
# ALISER - Configuración Apache (.htaccess)
# Reglas de Oro: Rutas Limpias y Seguridad
# ============================================

# Activar motor de reescritura
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /aliser-web/frontend/
    
    # ============================================
    # Rutas Limpias - Redirección a Secciones
    # ============================================
    
    # Si el archivo o directorio existe, servirlo directamente
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]
    
    # Redirigir /vacantes o /bolsa-trabajo a index.html con parámetro de sección
    RewriteRule ^(vacantes|bolsa-trabajo|trabaja-con-nosotros)$ index.html?section=vacantes [L,QSA]
    
    # Redirigir /terrenos a index.html con parámetro de sección
    RewriteRule ^terrenos$ index.html?section=terrenos [L,QSA]
    
    # Redirigir /promociones a index.html con parámetro de sección
    RewriteRule ^promociones$ index.html?section=promociones [L,QSA]
    
    # Redirigir /inicio o raíz a index.html
    RewriteRule ^(inicio|home)?$ index.html [L,QSA]
    
    # Redirigir cualquier otra ruta no encontrada a index.html
    RewriteRule ^(.*)$ index.html [L,QSA]
</IfModule>

# ============================================
# Seguridad - Bloquear Archivos Sensibles
# ============================================

# Bloquear acceso a archivos .env y variables de entorno
<FilesMatch "\.(env|ENV|env\.local|env\.production|env\.development)$">
    Require all denied
</FilesMatch>

# Bloquear acceso a archivos de configuración
<FilesMatch "^(\.htaccess|\.htpasswd|\.git|\.gitignore|\.gitattributes|\.editorconfig|\.eslintrc|\.prettierrc|composer\.json|composer\.lock|package\.json|package-lock\.json|yarn\.lock|\.npmrc|\.yarnrc)$">
    Require all denied
</FilesMatch>

# Bloquear acceso a archivos de backup y temporales
<FilesMatch "\.(bak|backup|old|tmp|temp|log|sql|db)$">
    Require all denied
</FilesMatch>

# Bloquear acceso a archivos de sistema
<FilesMatch "^(\.DS_Store|Thumbs\.db|desktop\.ini|\.svn|\.idea|\.vscode)$">
    Require all denied
</FilesMatch>

# Bloquear acceso a directorios ocultos
<IfModule mod_rewrite.c>
    RewriteRule ^\. - [F,L]
</IfModule>

# ============================================
# Headers de Seguridad
# ============================================

<IfModule mod_headers.c>
    # Prevenir clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Prevenir MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Habilitar XSS Protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Content Security Policy (ajustar según necesidades)
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' data: https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data:; connect-src 'self';"
</IfModule>

# ============================================
# Optimización y Performance
# ============================================

# Habilitar compresión GZIP
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml
</IfModule>

# Cache de archivos estáticos
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Imágenes
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    # CSS y JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    
    # Fuentes
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    
    # HTML
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# ============================================
# Configuración de Charset
# ============================================

AddDefaultCharset UTF-8
AddCharset UTF-8 .html .css .js .xml .json .rss .atom

# ============================================
# Prevenir listado de directorios
# ============================================

Options -Indexes

# ============================================
# Manejo de Errores Personalizados
# ============================================

ErrorDocument 404 /aliser-web/frontend/index.html#hero
ErrorDocument 403 /aliser-web/frontend/index.html#hero
ErrorDocument 500 /aliser-web/frontend/index.html#hero

# ============================================
# Configuración de Tipos MIME
# ============================================

<IfModule mod_mime.c>
    # WebP
    AddType image/webp .webp
    
    # JavaScript
    AddType application/javascript .js
    AddType text/javascript .js
    
    # JSON
    AddType application/json .json
    
    # Fuentes
    AddType font/woff .woff
    AddType font/woff2 .woff2
    AddType application/font-woff .woff
    AddType application/font-woff2 .woff2
</IfModule>

# ============================================
# FIN DE CONFIGURACIÓN
# ============================================
